<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تمرين: اليوم الآخر - منصة المبدأ التعليمية</title>
    <link rel="stylesheet" href="../../css/style.css"> <style>
        /* أنماط خاصة بالاختبار لتتناسب مع التنسيق السابق */
        .activity-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            text-align: right;
            position: relative; /* لإحتواء الأزرار بشكل صحيح */
        }
        .question-box {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 25px;
            margin-bottom: 25px;
            display: none; /* يتم إظهار السؤال الحالي فقط بواسطة JS */
        }
        .question-box.active {
            display: block;
        }
        .question-text {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #34495E;
            font-weight: bold;
        }
        .options label {
            display: block;
            margin-bottom: 15px;
            padding: 15px;
            background-color: #eee;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            font-size: 1.1em;
            font-weight: bold;
            border: 2px solid transparent;
        }
        .options label:hover {
            background-color: #e0e0e0;
        }
        .options input[type="radio"] {
            margin-left: 10px;
            transform: scale(1.2);
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 10px; /* مسافة بين الأزرار */
        }
        .navigation-buttons button {
            padding: 12px 25px;
            flex-grow: 1; /* لتوزيع المساحة بالتساوي */
            background-color: #3498DB;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: bold;
        }
        .navigation-buttons button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .navigation-buttons button.check-button {
            background-color: #2ECC71;
        }
        .navigation-buttons button.check-button:hover {
            background-color: #27AE60;
        }
        .navigation-buttons button.submit-button { /* زر إرسال نهائي */
            background-color: #E74C3C;
        }
        .navigation-buttons button.submit-button:hover {
            background-color: #C0392B;
        }
        .feedback-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-size: 1em;
            display: none; /* مخفي افتراضياً */
        }
        .feedback-box.correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #28a745;
        }
        .feedback-box.incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #dc3545;
        }
        .rationale {
            font-size: 0.9em;
            margin-top: 10px;
            color: #333;
        }
        .hint {
            font-size: 0.9em;
            margin-top: 5px;
            color: #6c757d;
            font-style: italic;
        }
        .correct-answer-highlight {
            border: 2px solid #28a745 !important;
            background-color: #d4edda !important;
        }
        .incorrect-answer-highlight {
            border: 2px solid #dc3545 !important;
            background-color: #f8d7da !important;
        }
        .results-summary {
            margin-top: 30px;
            padding: 20px;
            border-top: 2px solid #3498DB;
            background-color: #e9f5ff;
            border-radius: 8px;
            text-align: center;
            display: none;
        }
        .results-summary h3 {
            color: #34495E;
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        .results-summary p {
            font-size: 1.3em;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .incorrect-questions-list {
            margin-top: 20px;
            border-top: 1px dashed #A9CCE3;
            padding-top: 15px;
            text-align: right;
        }
        .incorrect-questions-list h4 {
            color: #E74C3C;
            font-size: 1.4em;
            margin-bottom: 10px;
        }
        .incorrect-questions-list ul {
            list-style: none;
            padding: 0;
        }
        .incorrect-questions-list li {
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #555;
            line-height: 1.5;
        }
        .restart-button {
            display: block;
            width: 200px;
            padding: 12px;
            margin: 20px auto 0;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .restart-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="header-content">
            <div class="header-left">
                <p>مدرسة المبدأ الابتدائية المختلطة</p>
            </div>
            <div class="header-center">
                <h1>منصة المبدأ التعليمية</h1>
                <p class="tagline">المنصة مخصصة لمادة التربية الإسلامية للصف الخامس الابتدائي</p>
            </div>
            <div class="header-right">
                <p>مديرية تربية الرصافة الثالثة</p>
            </div>
        </div>

        <nav class="main-nav">
            <ul>
                <li><a href="../../index.html">الرئيسية</a></li>
                <li><a href="../../units_overview.html">وحدات المادة</a></li>
                <li><a href="../../videos.html">الفيديوهات</a></li>
                <li><a href="../../activities.html" class="active">تمارين تفاعلية</a></li>
                <li><a href="../../about.html">من نحن</a></li>
                <li><a href="../../contact.html">اتصل بنا</a></li>
            </ul>
        </nav>
    </header>

    <main class="main-content lesson-page">
        <h2>تمرين الوحدة الخامسة - الدرس الثاني: اليوم الآخر</h2>

        <div class="activity-container">
            <div id="quiz-form">
                </div>

            <div class="navigation-buttons">
                <button id="prev-btn" class="nav-btn">السابق</button>
                <button id="check-btn" class="check-button">تحقق من الإجابة</button>
                <button id="next-btn" class="nav-btn">التالي</button>
            </div>

            <div id="results-summary" class="results-summary">
                <h3>نتائجك</h3>
                <p>عدد الإجابات الصحيحة: <span id="correct-count">0</span> من <span id="total-questions-summary">0</span></p>
                <p>عدد الإجابات الخاطئة: <span id="incorrect-count">0</span></p>
                <div id="incorrect-questions-list" class="incorrect-questions-list">
                    <h4>الأسئلة التي أخطأت فيها:</h4>
                    <ul>
                        </ul>
                </div>
                <button class="restart-button" onclick="restartQuiz()">إعادة الاختبار</button>
            </div>
        </div>

        <div class="lesson-navigation">
            <a href="../../units/unit5/topic2.html">العودة لدرس اليوم الآخر</a> <a href="../../activities.html">العودة لفهرس التمارين</a>
        </div>
    </main>

    <footer class="main-footer">
        <p class="designer-info">إعداد وتصميم: مرتضى الخفاجي</p>
    </footer>

    <script>
        const questions = [
            {
                question: "ما هو عنوان الدرس الثاني من الوحدة الخامسة؟",
                options: ["سورة الدخان", "سورة القلم", "من العقيدة الإسلامية: اليوم الآخر", "المزاح"],
                answer: "من العقيدة الإسلامية: اليوم الآخر",
                rationale: "الدرس الثاني من الوحدة الخامسة يتناول أحد أركان الإيمان وهو الإيمان باليوم الآخر.",
                hint: "يتحدث عن عالم ما بعد الموت."
            },
            {
                question: "ماذا نعني باليوم الآخر؟",
                options: ["اليوم الأخير في الأسبوع", "يوم القيامة الذي يبعث الله فيه الناس ويحاسبهم على أعمالهم", "يوم العيد", "يوم السفر"],
                answer: "يوم القيامة الذي يبعث الله فيه الناس ويحاسبهم على أعمالهم",
                rationale: "اليوم الآخر هو اليوم الذي يقوم فيه الناس من قبورهم للحساب والجزاء.",
                hint: "يوم الحساب العظيم."
            },
            {
                question: "لماذا يعد الإيمان باليوم الآخر ركناً من أركان الإيمان؟",
                options: ["لأنه يوم طويل", "لأن الإيمان لا يكتمل إلا به، وهو أساس في العقيدة الإسلامية", "لأنه مذكور في القرآن مرة واحدة", "لأنه يتعلق بالمستقبل فقط"],
                answer: "لأن الإيمان لا يكتمل إلا به، وهو أساس في العقيدة الإسلامية",
                rationale: "الإيمان باليوم الآخر من الأركان الأساسية للإيمان، ولا يصح إيمان العبد إلا به.",
                hint: "تذكر أركان الإيمان الستة."
            },
            {
                question: "ماذا يحدث للإنسان بعد موته؟",
                options: ["ينتهي وجوده تماماً", "يذهب مباشرة إلى الجنة أو النار", "ينتقل إلى عالم البرزخ، ثم يبعث يوم القيامة للحساب والجزاء", "يتحول إلى كائن آخر"],
                answer: "ينتقل إلى عالم البرزخ، ثم يبعث يوم القيامة للحساب والجزاء",
                rationale: "بعد الموت، يدخل الإنسان عالم البرزخ (القبر)، ثم يبعث في اليوم الآخر ليحاسب ويجازى على أعماله.",
                hint: "هناك حياة متوسطة بين الدنيا والآخرة."
            },
            {
                question: "اذكر اثنين من أسماء اليوم الآخر التي وردت في القرآن الكريم.",
                options: ["يوم العيد ويوم الجمعة", "يوم القيامة ويوم الحساب", "يوم السبت ويوم الأحد", "يوم المباراة ويوم النزهة"],
                answer: "يوم القيامة ويوم الحساب",
                rationale: "وردت لليوم الآخر أسماء كثيرة في القرآن الكريم تدل على عظمته وأحواله، مثل يوم القيامة، يوم الحساب، يوم الدين، وغير ذلك.",
                hint: "أسماء تدل على الحساب أو القيام."
            },
            {
                question: "ما هو دور الأعمال الصالحة التي نقوم بها في حياتنا الدنيا بالنسبة لليوم الآخر؟",
                options: ["ليس لها دور", "هي التي تحدد مصيرنا وجزاءنا يوم القيامة، فمن عمل خيراً وجد خيراً ومن عمل شراً وجد شراً", "هي للتباهي أمام الناس", "هي لأجل الحياة الدنيا فقط"],
                answer: "هي التي تحدد مصيرنا وجزاءنا يوم القيامة، فمن عمل خيراً وجد خيراً ومن عمل شراً وجد شراً",
                rationale: "الجزاء في الآخرة يكون على أساس الأعمال التي قدمها الإنسان في الدنيا، فكل عمل يحصى ويجازى عليه.",
                hint: "ما تزرعه في الدنيا تحصده في الآخرة."
            },
            {
                question: "ما جزاء المؤمنين الصالحين في اليوم الآخر؟",
                options: ["النار والعذاب", "العيش في صحراء قاحلة", "الجنة والنعيم المقيم", "الخلود في الدنيا"],
                answer: "الجنة والنعيم المقيم",
                rationale: "وعد الله المؤمنين الصالحين بالجنة، وهي دار الكرامة والنعيم الأبدي.",
                hint: "المكان الذي أعده الله لعباده الصالحين."
            },
            {
                question: "وما جزاء الكافرين والمجرمين في اليوم الآخر؟",
                options: ["الجنة", "النعيم المقيم", "النار والعذاب الأليم", "مغفرة الذنوب تلقائياً"],
                answer: "النار والعذاب الأليم",
                rationale: "توعد الله الكافرين والمجرمين بالنار، وهي دار العذاب والشقاء الأبدي.",
                hint: "المكان الذي أعده الله للعصاة والكافرين."
            },
            {
                question: "ما الفائدة من الإيمان باليوم الآخر في سلوك المسلم؟",
                options: ["لا فائدة منه", "يجعله لا يهتم بالدنيا", "يجعله يحرص على فعل الخيرات والابتعاد عن المنكرات، ويشعره بالمسؤولية أمام الله", "يجعله خائفاً دائماً"],
                answer: "يجعله يحرص على فعل الخيرات والابتعاد عن المنكرات، ويشعره بالمسؤولية أمام الله",
                rationale: "الإيمان باليوم الآخر يدفع المسلم إلى الاستقامة والتقوى، لأنه يعلم أن هناك حساباً وجزاءً.",
                hint: "كيف يؤثر الإيمان بالجزاء على تصرفاتنا؟"
            },
            {
                question: "هل هناك حساب وجزاء في الإسلام؟ ولماذا؟",
                options: ["لا يوجد حساب أو جزاء", "نعم، لحكمة الله وعدله، ليجازي المحسن على إحسانه والمسيء على إساءته", "نعم، ولكن فقط للأقوياء", "لا، فكل الناس سيدخلون الجنة"],
                answer: "نعم، لحكمة الله وعدله، ليجازي المحسن على إحسانه والمسيء على إساءته",
                rationale: "من عدل الله تعالى وحكمته أن يكون هناك حساب وجزاء، لكي يأخذ كل ذي حق حقه.",
                hint: "صفة من صفات الله تعالى تقتضي العدالة."
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let userChoices = new Array(questions.length).fill(null); // To store selected option value
        let questionAnsweredCorrectly = new Array(questions.length).fill(false); // To track if question was answered correctly

        const quizForm = document.getElementById('quiz-form');
        const prevBtn = document.getElementById('prev-btn');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const resultsSummary = document.getElementById('results-summary');
        const correctCountSpan = document.getElementById('correct-count');
        const incorrectCountSpan = document.getElementById('incorrect-count');
        const totalQuestionsSummarySpan = document.getElementById('total-questions-summary');
        const incorrectQuestionsList = document.querySelector('#incorrect-questions-list ul');

        totalQuestionsSummarySpan.textContent = questions.length;

        function renderQuestion(index) {
            quizForm.innerHTML = ''; // Clear previous question
            const qData = questions[index];

            const questionBox = document.createElement('div');
            questionBox.className = 'question-box active';
            questionBox.innerHTML = `
                <div class="question-text">${index + 1}. ${qData.question}</div>
                <div class="options" id="options-${index}"></div>
                <div class="feedback-box" id="feedback-${index}">
                    <p id="feedback-text-${index}"></p>
                    <p class="rationale" id="rationale-text-${index}"></p>
                    <p class="hint" id="hint-text-${index}"></p>
                </div>
            `;
            quizForm.appendChild(questionBox);

            const optionsContainer = document.getElementById(`options-${index}`);
            // Shuffle options to prevent memorization by position
            const shuffledOptions = [...qData.options].sort(() => Math.random() - 0.5);

            shuffledOptions.forEach((optionText, optIndex) => {
                const label = document.createElement('label');
                label.innerHTML = `
                    <input type="radio" name="q${index}" value="${optionText}" data-question-index="${index}">
                    ${optionText}
                `;
                label.onclick = () => selectOption(index, optionText, label);
                optionsContainer.appendChild(label);

                // Restore selected choice if already made
                if (userChoices[index] === optionText) {
                    label.classList.add('selected');
                    label.querySelector('input[type="radio"]').checked = true;
                }
            });

            // If question was already checked, show feedback and disable options
            if (questionAnsweredCorrectly[index] || userChoices[index] !== null) {
                displayFeedback(index, true);
                disableOptions(index);
                checkBtn.disabled = true;
            } else {
                checkBtn.disabled = true; // Initially disable check button
                // If user already made a choice on a previous visit to this question, enable check button
                if (userChoices[index] !== null) {
                    checkBtn.disabled = false;
                }
            }
            updateNavigationButtons();
        }

        function selectOption(qIndex, selectedValue, selectedLabel) {
            userChoices[qIndex] = selectedValue;
            const optionsDiv = document.getElementById(`options-${qIndex}`);
            optionsDiv.querySelectorAll('label').forEach(label => {
                label.classList.remove('selected', 'correct-answer-highlight', 'incorrect-answer-highlight');
            });
            selectedLabel.classList.add('selected');

            // Hide feedback when a new option is selected
            document.getElementById(`feedback-${qIndex}`).style.display = 'none';
            checkBtn.disabled = false; // Enable check button when an option is selected
        }

        function checkAnswer() {
            const qData = questions[currentQuestionIndex];
            const selectedValue = userChoices[currentQuestionIndex];
            const feedbackBox = document.getElementById(`feedback-${currentQuestionIndex}`);
            const feedbackTextElem = document.getElementById(`feedback-text-${currentQuestionIndex}`);
            const rationaleTextElem = document.getElementById(`rationale-text-${currentQuestionIndex}`);
            const hintTextElem = document.getElementById(`hint-text-${currentQuestionIndex}`);
            const optionsDiv = document.getElementById(`options-${currentQuestionIndex}`);

            // Clear previous highlights
            optionsDiv.querySelectorAll('label').forEach(label => {
                label.classList.remove('correct-answer-highlight', 'incorrect-answer-highlight');
            });

            if (selectedValue === null) {
                feedbackBox.style.display = 'block';
                feedbackBox.className = 'feedback-box incorrect';
                feedbackTextElem.textContent = 'الرجاء اختيار إجابة.';
                rationaleTextElem.textContent = '';
                hintTextElem.textContent = '';
                return;
            }

            // Highlight selected option
            optionsDiv.querySelectorAll(`input[value="${selectedValue}"]`).forEach(input => {
                input.closest('label').classList.add('selected');
            });

            if (selectedValue === qData.answer) {
                feedbackBox.className = 'feedback-box correct';
                feedbackTextElem.textContent = 'إجابة صحيحة!';
                if (!questionAnsweredCorrectly[currentQuestionIndex]) { // Only increment score if not already correct
                    score++;
                    questionAnsweredCorrectly[currentQuestionIndex] = true;
                }
                optionsDiv.querySelectorAll(`input[value="${selectedValue}"]`).forEach(input => {
                    input.closest('label').classList.add('correct-answer-highlight');
                });
            } else {
                feedbackBox.className = 'feedback-box incorrect';
                feedbackTextElem.textContent = `إجابة خاطئة. الإجابة الصحيحة هي: ${qData.answer}`;
                // Highlight incorrect selected option
                optionsDiv.querySelectorAll(`input[value="${selectedValue}"]`).forEach(input => {
                    input.closest('label').classList.add('incorrect-answer-highlight');
                });
                // Highlight correct option
                optionsDiv.querySelectorAll(`input[value="${qData.answer}"]`).forEach(input => {
                    input.closest('label').classList.add('correct-answer-highlight');
                });
            }

            rationaleTextElem.textContent = `الشرح: ${qData.rationale}`;
            hintTextElem.textContent = `تلميح: ${qData.hint}`;
            feedbackBox.style.display = 'block';

            disableOptions(currentQuestionIndex);
                checkBtn.disabled = true; // Disable after checking
        }

        function disableOptions(qIndex) {
            document.getElementById(`options-${qIndex}`).querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.disabled = true;
            });
        }

        function displayFeedback(qIndex, isChecked) {
            const feedbackBox = document.getElementById(`feedback-${qIndex}`);
            const feedbackTextElem = document.getElementById(`feedback-text-${qIndex}`);
            const rationaleTextElem = document.getElementById(`rationale-text-${qIndex}`);
            const hintTextElem = document.getElementById(`hint-text-${qIndex}`);
            const qData = questions[qIndex];
            const selectedValue = userChoices[qIndex];
            const optionsDiv = document.getElementById(`options-${qIndex}`);

            // Clear previous highlights
            optionsDiv.querySelectorAll('label').forEach(label => {
                label.classList.remove('correct-answer-highlight', 'incorrect-answer-highlight');
            });

            if (isChecked && selectedValue !== null) {
                feedbackBox.style.display = 'block';
                if (selectedValue === qData.answer) {
                    feedbackBox.className = 'feedback-box correct';
                    feedbackTextElem.textContent = 'إجابة صحيحة!';
                    optionsDiv.querySelectorAll(`input[value="${selectedValue}"]`).forEach(input => {
                        input.closest('label').classList.add('correct-answer-highlight');
                    });
                } else {
                    feedbackBox.className = 'feedback-box incorrect';
                    feedbackTextElem.textContent = `إجابة خاطئة. الإجابة الصحيحة هي: ${qData.answer}`;
                    optionsDiv.querySelectorAll(`input[value="${selectedValue}"]`).forEach(input => {
                        input.closest('label').classList.add('incorrect-answer-highlight');
                    });
                    optionsDiv.querySelectorAll(`input[value="${qData.answer}"]`).forEach(input => {
                        input.closest('label').classList.add('correct-answer-highlight');
                    });
                }
                rationaleTextElem.textContent = `الشرح: ${qData.rationale}`;
                hintTextElem.textContent = `تلميح: ${qData.hint}`;
            } else {
                feedbackBox.style.display = 'none';
            }
        }


        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.textContent = 'عرض النتائج';
                nextBtn.classList.add('submit-button');
                nextBtn.classList.remove('nav-btn');
            } else {
                nextBtn.textContent = 'التالي';
                nextBtn.classList.remove('submit-button');
                nextBtn.classList.add('nav-btn');
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
            }
        }

        function showResults() {
            quizForm.style.display = 'none';
            document.querySelector('.navigation-buttons').style.display = 'none';

            let finalCorrectCount = 0;
            let finalIncorrectCount = 0;
            incorrectQuestionsList.innerHTML = ''; // Clear previous list

            questions.forEach((qData, index) => {
                const selectedValue = userChoices[index];
                if (selectedValue === qData.answer) {
                    finalCorrectCount++;
                } else {
                    finalIncorrectCount++;
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `السؤال رقم ${index + 1}: ${qData.question} <br> (الإجابة الصحيحة: <strong>${qData.answer}</strong>)`;
                    incorrectQuestionsList.appendChild(listItem);
                }
            });

            correctCountSpan.textContent = finalCorrectCount;
            incorrectCountSpan.textContent = finalIncorrectCount;
            resultsSummary.style.display = 'block';
            window.scrollTo(0, document.body.scrollHeight); // Scroll to results
        }

        function restartQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            userChoices.fill(null);
            questionAnsweredCorrectly.fill(false);
            resultsSummary.style.display = 'none';
            quizForm.style.display = 'block';
            document.querySelector('.navigation-buttons').style.display = 'flex';
            renderQuestion(currentQuestionIndex);
        }

        // Initialize quiz
        renderQuestion(currentQuestionIndex);

        // Event Listeners for navigation and check
        prevBtn.addEventListener('click', prevQuestion);
        nextBtn.addEventListener('click', nextQuestion);
        checkBtn.addEventListener('click', checkAnswer);

    </script>
</body>
</html>